#!/bin/bash

# Windows-compatible MySQL Backup Script for Git Bash

# MySQL Database Credentials
DB_USER="root"
DB_PASS="awsPassword123fk"
DB_HOST="ispj-db.cxruucec3o8o.us-east-1.rds.amazonaws.com"
DB_NAME="ISPJ_DB"

# Backup Storage Directory (Change to your actual path)
BACKUP_DIR="$(pwd)"  # Uses the current directory
TIMESTAMP=$(date +"%Y-%m-%d_%H-%M-%S")
BACKUP_FILE="$BACKUP_DIR/db_backup_$TIMESTAMP.sql.gz"

# Find MySQL bin directory
MYSQLDUMP_PATH="/c/Program Files/MySQL/MySQL Server 8.0/bin/mysqldump.exe"

# Ensure MySQL Dump exists
if [ ! -f "$MYSQLDUMP_PATH" ]; then
    echo "Error: mysqldump not found. Check your MySQL installation path!"
    exit 1
fi

# Ensure backup directory exists
mkdir -p "$BACKUP_DIR"

# Run MySQL dump and compress the backup
"$MYSQLDUMP_PATH" -h "$DB_HOST" -u "$DB_USER" -p"$DB_PASS" "$DB_NAME" | gzip > "$BACKUP_FILE"

# Keep only the last 7 backups
find "$BACKUP_DIR" -type f -name "*.sql.gz" -mtime +7 -exec rm {} \;

echo "Backup completed successfully: $BACKUP_FILE"

#CREATE DATABASE test_backup_db;
